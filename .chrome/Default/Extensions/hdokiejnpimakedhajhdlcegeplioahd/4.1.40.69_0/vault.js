LPVault={};
(function(e,b,ja){var ka=Strings.translateString("Folder (a-z)"),la=Strings.translateString("Folder (z-a)"),z=Strings.translateString("Name (a-z)"),A=Strings.translateString("Name (z-a)"),Q=Strings.translateString("Most Recent"),ma=Strings.translateString("Sender (a-z)"),na=Strings.translateString("Sender (z-a)"),oa=Strings.translateString("Recipient (a-z)"),pa=Strings.translateString("Recipient (z-a)"),H=[ka,la,z,A,Q],Oa=[z,A],Pa=[z,A,oa,pa,Q],Qa=[z,A,ma,na,Q],Ra=[z,A],Sa=[z,A],p=function(a){this.options=a};
p.prototype.getAddElement=function(){void 0===this.addElement&&(this.addElement=LPTools.createElement("div","addMenuItem"),this.build(this.addElement,this.options.icon?this.options.icon:"images/vault_4.0/Add.png"));return this.addElement};p.prototype.build=function(a,c){a.appendChild(LPTools.createElement("span",null,Strings.Vault[this.options.text]));var b=LPTools.createElement("div"),g=LPTools.createElement("div"),v=LPTools.createElement("img",{src:c});a.appendChild(b);b.appendChild(g);g.appendChild(v);
$(a).bind("click",this.options.func)};p.prototype.getMenuElement=function(){void 0===this.menuElement&&(this.menuElement=LPTools.createElement("li","addMenuItem"),this.build(this.menuElement,this.options.additionalIcon));return this.menuElement};var Ta=new p({text:"ADD_SITE",icon:"images/vault_4.0/Sites_Active.png",func:function(){b.openSiteDialog({saveOptions:{source:"vault"}})}}),Y=new p({text:"ADD_NOTE",icon:"images/vault_4.0/Notes_Active.png",additionalIcon:"images/vault_4.0/Add_Secure_Note.png",
func:function(){b.openNoteDialog({saveOptions:{source:"vault"}})}}),Ua=new p({text:"ADD_FORM_FILL",icon:"images/vault_4.0/Form_Fills_Active.png",func:function(){b.openFormFillDialog({saveOptions:{source:"vault"}})}}),Va=new p({text:"ADD_SHARED_FOLDER",func:function(){b.openCreateSharedFolderDialog()}}),Wa=new p({text:"ADD_IDENTITY",func:function(){b.openIdentityDialog()}}),Xa=new p({text:"GIVE_EMER_ACCESS",func:function(){dialogs.addEmergencyAccess.open()}}),Ya=new p({text:"ADD_CREDIT_MON",func:function(){b.openCreateCreditMonitoringDialog()}}),
qa=new p({text:"ADD_FOLDER",additionalIcon:"images/vault_4.0/Add_Folder.png",func:function(){b.openFolderDialog()}}),I=new p({text:"SHARE_ITEMS",additionalIcon:"images/vault_4.0/Add_Share.png",func:function(){b.openShareDialog()}}),Za=Strings.translateString("search my vault"),n=null,Z=$("#advacedOptionsOverlay"),$a=$("#inProgressOverlay"),R=$("#tools"),ab=$("#options"),r=$("#mainScroll"),w=$("#addMenu"),ra=$("#addMenuItems"),sa=$("#addMenuButton"),ta=$("#addMenuButtonCustom"),ua=$("#gridButton"),
va=$("#listButton"),S=$("#collapseAllToggle"),T=$("#sizeToggle"),wa=$("#orderOption"),xa=$("#sortOrderMenu"),bb=$("#sortOrderOption"),aa=$("#userMenuItems"),E=$("#leftMenuMinimizeButton"),ya=$("#moreActions"),za=e.getElementById("contextMenu").parentElement,h=$(e.body),ba=$("#advancedMenuItem"),ca=e.getElementById("sortOrderMenu").children[0],q=$("#vaultSearch"),Aa=$("#userMenuContainer"),cb=$("#pageTitle"),U=null,B=null,V=!0,x=null,t=null,f=null,Ba=function(a,c){f.getContainer()===c&&(f.removeBodyState(),
f.addBodyState())},d=function(a){a=a||{};this.state=a.bodyState;this.menuElement=a.menuElement||null;this.emptyState=this.state+"Empty";this.container=null;this.sortOptions=a.sortOptions||null;this.persistent=LPTools.getOption(a,"persistent",!0);this.searchPlaceholder=LPTools.getOption(a,"searchPlaceholder",Za);this.title=a.title||"";this.addMenu=a.addMenu;this.additionalOptionButtons=a.additionalOptionButtons;this.scrollParent=a.scrollParent;this.notificationCount=a.notificationCount;(function(c){Topics.get(Topics.CLEAR_DATA).subscribe(function(){c.clear()});
a.menuElement&&a.menuElement.bind("click",function(){c.parent?c.parent.show(c):c.show()})})(this)};(function(){d.prototype.applyContainerFunction=function(a){var c=this.getContainer();if(null!==c)switch(typeof a){case "string":var b=[];if(1<arguments.length)for(var g=1,v=arguments.length;g<v;++g)b.push(arguments[g]);return c[a].apply(c,b);case "function":return a(c)}};d.prototype.updateNotificationCount=function(a){var c=0,b=this.menuElement.find(".tabNotification");"undefined"!==typeof a?(c=parseInt(b.text()),
W(b,c-a),this.parent&&this.parent.updateNotificationCount(a)):this.notificationCount&&(c=this.notificationCount(),W(b,c));return c};d.prototype.getSortOptions=function(){return this.sortOptions};d.prototype.getContainer=function(){return this.container};d.prototype.setContainer=function(a,c){if(this.container=a)a._buildOptions.stateChangeCallback=Ba,LPTools.getOption(c,"checkForStateChange",!0)&&f===this&&Ba(a.isEmpty(),a),f===this&&""!==q.val()&&b.search(q.val())};d.prototype.openAll=function(){this.applyContainerFunction("openAll")};
d.prototype.collapseAll=function(){this.applyContainerFunction("collapseAll")};d.prototype.createSelectionContextMenu=function(){return this.applyContainerFunction("createSelectionContextMenu")};d.prototype.isEmpty=function(){return this.applyContainerFunction("isEmpty")};d.prototype.search=function(a){var c=this.applyContainerFunction("applySearch",a);a&&null===c&&!this.isEmpty()?h.addClass("searchEmpty"):h.removeClass("searchEmpty")};d.prototype.clearSelected=function(){this.applyContainerFunction("clearSelected")};
d.prototype.getSelectedItems=function(){return this.applyContainerFunction("getSelectedItems")};d.prototype.getSortOrder=function(){void 0===this.sortOrder&&(this.sortOrder=LPProxy.getPreference(this.state+"SortOrder",this.sortOptions?this.sortOptions[0]:null));return this.sortOrder};d.prototype.setSortOrder=function(a){this.sortOrder=a;LPProxy.setPreferences(this.state+"SortOrder",a)};d.prototype.addBodyState=function(){h.addClass(this.getState());var a=this.getContainer();null!==a&&a.isEmpty()&&
0===oneMinuteSignup.getReminderCount()?h.addClass("empty"):h.removeClass("empty");setTimeout(function(){Topics.get(Topics.EMPTY_VAULT_STATE_CHANGE).publish()},400)};d.prototype.removeBodyState=function(){h.removeClass(this.emptyState);h.removeClass(this.state)};d.prototype.hide=function(){null!==this.menuElement&&this.menuElement.removeClass("selected");this.parent&&null!==this.parent.menuElement&&this.parent.menuElement.removeClass("selected");this.removeBodyState();if(this.additionalOptionButtons)for(var a=
0,c=this.additionalOptionButtons.length;a<c;++a)this.additionalOptionButtons[a].detach();this.persistent?this.applyContainerFunction("hide"):this.clear()};d.prototype.getAddMenuItems=function(){var a=[];if(this.addMenu&&0<this.addMenu.length)for(var c=0,b=this.addMenu.length;c<b;++c){var g=this.addMenu[c];g===I&&!LPFeatures.allowIndividualSharing()||g===Y&&!LPFeatures.allowNotes()||a.push(g)}return a};d.prototype.show=function(){if(f!==this){null!==f&&(q.val(""),C(),f.hide());q.attr("placeholder",
this.searchPlaceholder);null!==this.menuElement&&this.menuElement.addClass("selected");this.parent&&null!==this.parent.menuElement&&this.parent.menuElement.addClass("selected");cb.text(this.title);this.addBodyState();this.scrollParent.scrollTop(0);var a=this.getSortOptions();if(null===f||f.getSortOptions()!==a)if(null!==a){LPTools.removeDOMChildren(ca);for(var c=0,k=a.length;c<k;++c){var g=e.createElement("li"),v=a[c];g.textContent=v;LPPlatform.addEventListener(g,"click",db(v));ca.appendChild(g)}wa.show()}else wa.hide();
f=this;(a=this.getSortOrder())&&b.sort(a);this.additionalOptionButtons&&ab.append(this.additionalOptionButtons);ra.children().detach();ta.children().detach();a=this.getAddMenuItems();if(0<a.length){ta.append(a[0].getAddElement());for(c=a.length-1;0<c;--c)ra.append(a[c].getMenuElement());sa.show()}else sa.hide()}};d.prototype.getState=function(){return this.isEmpty()?this.emptyState:this.state};d.prototype.clear=function(){this.container&&(this.container.destruct(),this.container=null)}})();var l=
function(a){a.bodyState=a.bodyState||a.contentID;d.call(this,a);this.contentElement=e.getElementById(a.contentID);this.containerType=a.containerType;this.dataSource=a.dataFunction;this.buildOptions=a.buildOptions;this.filter=a.filter;(function(a){Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(c){a.refresh(c)});a.initializeCallback=function(c,b){var k=new a.containerType(c,a.buildOptions);k.initialize(a.contentElement,a.scrollParent);a.filter&&k.applyFilter(a.filter,{checkForStateChange:!1});
a.setContainer(k,{checkForStateChange:LPTools.getOption(b,"checkForStateChange",!1)});Topics.get(Topics.DIALOG_LOADED).publish()}})(this)};l.prototype=Object.create(d.prototype);l.prototype.constructor=l;(function(){l.prototype.makeDataRequest=function(a,c){c.error=function(){Topics.get(Topics.DIALOG_LOADED).publish()};LPRequest.makeDataRequest(a,c)};l.prototype.initialize=function(a,c){null===this.container&&null!==this.containerType&&null!==this.dataSource&&(a=function(a,c){return c?function(b,
k){a.initializeCallback(b,k);c()}:a.initializeCallback}(this,a),Topics.get(Topics.DIALOG_LOADING).publish(),this.dataSource.call(this,a,c))};l.prototype.show=function(a){null===this.container?function(c){c.initialize(function(){a&&a();d.prototype.show.apply(c)})}(this):(d.prototype.show.apply(this),a&&a())};l.prototype.refresh=function(a){null!==this.container&&(this.container.destruct(),this.container=null,this.initialize(null,{identity:a,checkForStateChange:!0}))}})();var D=function(a){d.call(this,
a);this.setContainer(a.container||null);this.filter=a.filter};D.prototype=Object.create(d.prototype);D.prototype.constructor=D;D.prototype.show=function(){this.container.applyFilter(this.filter,{checkForStateChange:!1});d.prototype.show.apply(this,arguments)};var Ca=function(a){var c=null;if(a.views&&0<a.views.length){for(var b=0,g=a.views.length;b<g;++b)a.views[b].parent=this;this.show=function(b,k){b?(b.show(k),c=b):(null===c&&(c=a.defaultView()),c.show(k))};this.clear=function(){c=null};this.menuElement=
a.menuElement;var v=a.menuElement.find(".notificationBubble");this.updateNotificationCount=function(a){W(v,parseInt(v.text())-a)};b=function(){for(var c=0,b=0,k=a.views.length;b<k;++b)c+=a.views[b].updateNotificationCount();W(v,c)};Topics.get(Topics.LOGIN).subscribe(b);Topics.get(Topics.REFRESH_DATA).subscribe(b);(function(a){Topics.get(Topics.CLEAR_DATA).subscribe(function(){a.clear()})})(this)}},u=new D({filter:{showEmptyGroups:!0,func:function(a){return a instanceof AccountBaseDisplay||a instanceof
ApplicationDisplay||a instanceof GroupDisplay}},sortOptions:H,menuElement:$("#vaultMenuItem"),bodyState:"site",scrollParent:r,title:Strings.translateString("Sites"),addMenu:[Ta,Y,I,qa]}),Da=new D({filter:{showEmptyGroups:!1,func:function(a){return a instanceof NoteDisplay||a instanceof GroupDisplay}},sortOptions:H,menuElement:$("#notesMenuItem"),bodyState:"note",scrollParent:r,title:Strings.translateString("Secure Notes"),addMenu:[Y,I,qa]}),Ea=new D({filter:{showEmptyGroups:!1,multiSelect:!1,hasFolderView:!1,
func:function(a){return a instanceof FormFillDisplay}},sortOptions:Oa,menuElement:$("#formFillMenuItem"),bodyState:"formFill",scrollParent:r,title:Strings.translateString("Form Fills"),addMenu:[Ua]}),Fa=new l({containerType:IdentityContainer,dataFunction:function(a){for(var c=[],b=0,g=n._identities.length;b<g;++b)c.push(n._identities[b].newDisplayObject());a(c)},sortOptions:Sa,contentID:"identityContent",bodyState:"identity",scrollParent:r,searchPlaceholder:Strings.translateString("search my identities"),
buildOptions:{multiSelect:!1},title:Strings.translateString("Identities"),addMenu:[Wa]}),X=new l({containerType:CreditMonitoringContainer,dataFunction:function(){return function(a,c){this.makeDataRequest(LPProxy.getCreditMonitoringData,{success:function(b){for(var g=!0,k=[],e=0,d=b.length;e<d;++e){var m=b[e];"1"!==m.premium&&(g=!1);k.push(new CreditMonitoringProfile(m))}b=$("#creditMonitoring .viewExplanation");g?(b.hide(),X.title=Strings.translateString("Premium Credit Monitoring")):(b.show(),X.title=
Strings.translateString("Credit Monitoring"));a(k,c)}})}}(),persistent:!1,contentID:"creditMonitoring",scrollParent:r,title:Strings.translateString("Credit Monitoring"),addMenu:[Ya]}),da=new l({containerType:GridListContainer,dataFunction:function(a,c){this.makeDataRequest(LPProxy.getDeletedItems,{success:a})},filter:{showEmptyGroups:!1},sortOptions:H,contentID:"deletedItems",scrollParent:r,persistent:!1,searchPlaceholder:Strings.translateString("search my deleted items"),buildOptions:{allowDrag:!1,
stickyFolders:!0,stickyFolderParent:e.getElementById("main")},title:Strings.translateString("Deleted Items"),additionalOptionButtons:[function(){var a=LPTools.createElement("div",{"class":"optionButton optionButtons",id:"purgeAllButton"},Strings.Vault.PURGE_ALL);LPPlatform.addEventListener(a,"click",function(){var a=da.getContainer();a&&(a=a.getItemModelChildren(),0<a.length&&a[0].purge({itemsForAction:a}))});return $(a)}()]});da.refresh=function(){};var J=new l({containerType:EmergencyAccessRecipientContainer,
dataFunction:function(a,c){this.makeDataRequest(LPProxy.getEmergencyAccessRecipientInfo,{success:a})},filter:{showEmptyGroups:!1},sortOptions:H,menuElement:$("#emergencyTrustedMenuItem"),contentID:"emergencyTrustedContainer",bodyState:"emergencyTrusted",scrollParent:r,persistent:!1,searchPlaceholder:Strings.translateString("search people I trust"),buildOptions:{allowDrag:!1},title:Strings.translateString("People I Trust"),addMenu:[Xa]}),K=new l({containerType:EmergencyAccessSharerContainer,dataFunction:function(a,
c){this.makeDataRequest(LPProxy.getEmergencyAccessSharerInfo,{success:a})},filter:{showEmptyGroups:!1},notificationCount:function(){var a=0,c=bg.get("g_emer_sharers");if(c)for(var b=0,g=c.length;b<g;++b)"0"===c[b].accepted&&++a;return a},sortOptions:H,menuElement:$("#emergencyTrustingMenuItem"),contentID:"emergencyTrusting",bodyState:"emergencyTrusting",scrollParent:r,persistent:!1,searchPlaceholder:Strings.translateString("search people who trust me"),buildOptions:{allowDrag:!1},title:Strings.translateString("People Who Trust Me")}),
ea=new Ca({menuElement:$("#emergencyAccessMenuItem"),defaultView:function(){return 0<K.notificationCount()?K:J},views:[J,K]}),L=new l({containerType:IndividualShareContainer,sortOptions:Qa,menuElement:$("#receivedSharesMenuItem"),contentID:"receivedSharesContent",bodyState:"receivedShares",scrollParent:r,persistent:!1,notificationCount:function(){return bg.get("g_pendings").length},searchPlaceholder:Strings.translateString("search my received shares"),buildOptions:{multiSelect:!1},filter:{showEmptyGroups:!1,
multiSelect:!1},title:Strings.translateString("Shared with Me"),addMenu:[I],dataFunction:function(){return function(a,c){this.makeDataRequest(LPProxy.getReceivedShareData,{params:{},success:function(c){for(var b=LPProxy.getAllModelItems(),k=[],e=0,d=b.length;e<d;++e){var m=b[e],f=c[m.getID()];f&&"1"===f.state&&m instanceof AccountBase&&k.push(new AcceptedReceivedSharedItem(m,f))}b=LPProxy.getPendingRecievedShares();e=!1;d=0;for(m=b.length;d<m;++d){var f=b[d],h=c[f._model.getID()];h?f._model._shareData=
h:e=!0}e&&LPProxy.refreshSites();a(k.concat(b))}})}}()}),M=new l({containerType:IndividualShareContainer,sortOptions:Pa,menuElement:$("#sentSharesMenuItem"),contentID:"sentSharesContent",bodyState:"sentShares",scrollParent:r,persistent:!1,searchPlaceholder:Strings.translateString("search my sent shares"),buildOptions:{multiSelect:!1},filter:{showEmptyGroups:!1,multiSelect:!1},title:Strings.translateString("Shared with Others"),addMenu:[I],dataFunction:function(){return function(a,c){this.makeDataRequest(LPProxy.getSentShareData,
{params:{},success:function(b){for(var k=LPProxy.getAllModelItems(),e=[],d=0,f=k.length;d<f;++d)var m=k[d],e=e.concat(LPTools.buildSentShareItems(m,b[m.getID()]));a(e,c)}})}}()}),y=new l({containerType:SharedFolderContainer,dataFunction:function(){return function(a,c){this.makeDataRequest(LPProxy.getSharedFolderData,{params:{},success:function(c){for(var b=LPProxy.getAllSharedGroupModelsByID(),k=[],e=0,d=c.length;e<d;++e){var f=c[e];f.sharedata&&k.push(new SharedFolderItem(b[f.shareid],f))}a(k)}})}}(),
notificationCount:function(){return bg.get("g_pending_shares").length},sortOptions:Ra,menuElement:$("#sharedFoldersMenuItem"),contentID:"sharedFoldersContent",bodyState:"sharedFolders",scrollParent:r,searchPlaceholder:Strings.translateString("search my shared folders"),buildOptions:{multiSelect:!1},title:Strings.translateString("Shared Folders"),addMenu:[Va],additionalOptionButtons:[function(){var a=$(LPTools.buildCheckbox(null,{text:Strings.translateString("View Deleted Shared Folders")}));a.attr("id",
"showDeletedSharedFoldersButton");a.addClass("optionButtons");a.bind("click",function(){N?fa():ga()});return a}()]});y.initialize=function(a,c){a=function(a,c){return c?function(){var a={checkForStateChange:!1};N?ga(a):fa(a);c()}:function(){var a={checkForStateChange:!1};N?ga(a):fa(a)}}(this,a);l.prototype.initialize.call(this,a,c)};var O=new Ca({menuElement:$("#sharingMenuItem"),defaultView:function(){return 0<L.notificationCount()?L:LPProxy.getAccountClass()===Constants.USER_FREE?M:LPFeatures.allowSharedFolders()?
y:L},views:[y,M,L]}),P=function(){LPTools.hideContextMenu(t);t=null},F=function(a){a.preventDefault();a.stopPropagation()},ia=function(){P();aa.hide("fast");Aa.removeClass("selected");ha();Ga()},C=function(){f&&f.clearSelected()},db=function(a){return function(c){P();b.sort(a);F(c)}},ha=function(){ba.removeClass("selected");R.hide("fast");Z.hide()},Ha=function(){w.addClass("open")},Ga=function(){w.removeClass("open")};b.initialize=function(a){var c=$("#showReminders");bg.get("g_one_minute_signup_enabled")?
oneMinuteSignup.fetchReminders():c.addClass("hidden");bg.isOffline()?(c.attr("data-toggle","tooltip"),c.attr("title","You have to be online."),c.addClass("disabled")):(c.removeAttr("data-toggle"),c.removeAttr("title"),c.removeClass("disabled"));oneMinuteSignup.setOpenTourFn(b.openTour);try{LPProxy.initializeModel();e.body.removeAttribute("class");Topics.get(Topics.REFRESH_PREFERENCES).publish();$(".leftMenuItem").removeClass("selected");LPProxy.getPreference("gridView")||b.displayAsList();LPProxy.getPreference("compactView")&&
b.displayCompact();n=LPProxy.getUser();n.initialize(aa,$("#userMenuText"));VaultState.setIdentities(n._identities);LPProxy.enableCurrentIdentity(n._identities);n.isFree()&&this.showAdPane();this.firstTimeLogin();LPTools.parseUserSpecificMenu(e.getElementById("tools"),n._accountClass);LPTools.parseUserSpecificMenu(e.getElementById("more"),n._accountClass);Ia();LPProxy.getSecurityChallengeScore(Ja);E.attr("title","Maximize Menu");if(LPFeatures.allowGift()){var k=$("#specialOfferMenu");k.show();k.bind("click",
function(){bg.openURL(LPProxy.getBaseURL()+"gift.php")})}eb(LPProxy.getAccountClass());fb();LPPlatform.showIntroTutorial();gb()}catch(v){LPPlatform.logException(v)}finally{var g=$("#vaultLoadingOverlay");LPTools.getOption(a,"fadeIn",!1)?(g.addClass("fadeIn"),setTimeout(function(){g.addClass("loaded")},500)):g.addClass("loaded");h.addClass("loaded")}};var Ka=function(){LPProxy.getPreference("leftMenuMaximize")&&b.toggleLeftMenu()},gb=function(){if(bg.get("g_one_minute_signup_menu_enabled")&&LPPlatform.lpIsExtension()){var a=
bg.get("g_onemin_advert_app_threshold"),c=LPProxy.getAllModelItems().length;a&&c>a?$("#vaultFooter").addClass("disabled"):$("#vaultFooter").removeClass("disabled")}else $("#vaultFooter").addClass("disabled");$("#linkToOnemin","#vaultFooter").click(function(a){bg.sendLpImprove("oneminute::notificationfromvaultomsstart");oneMinuteSignup.show(oneMinuteSignup.modes.normal);return!1})},fb=function(){var a=function(a){b.openReceivedShareCenter(function(){var c=LPProxy.getPendingRecievedShare(a);c&&b.openAcceptShareDialog(c)})},
c=function(a){b.openReceivedShareCenter(function(){var c=LPProxy.getPendingRecievedShare(a);c&&c.reject()})};return function(){var e=LPTools.getURLParams();LPPlatform.setIntroTutorialDisable(!1);for(var g in e){var d=e[g];"cmd"===g&&(g=d);switch(g){case "opengoogleauth":case "opensettings":Topics.get(Topics.EDIT_SETTINGS).publish();break;case "openhistory":LPProxy.openHistory();break;case "openbookmarklets":LPProxy.openBookmarklets();break;case "linkpersonal":b.openLinkAccountDialog();break;case "unlinkpersonal":b.unlinkAccount();
break;case "sharedfolder":case "sf":b.openSharingCenter();break;case "addidentity":b.openManageIdentities();b.openIdentityDialog();break;case "showdeleted":b.openDeletedItems();break;case "viewcreditmon":b.openCreditMonitoring();break;case "share":for(var h=[],d=d.split(","),l=0,m=d.length;l<m;++l){var p=d[l],n=LPProxy.getSiteModel(p);n||(n=LPProxy.getNoteModel(p));n&&h.push(n)}0<h.length&&b.openShareDialog(h);break;case "edit":LPProxy.getSiteModel(d)?b.openSiteDialog({vaultItem:d}):LPProxy.getNoteModel(d)&&
b.openNoteDialog({vaultItem:d});break;case "acceptshare":a(d);break;case "rejectshare":c(d);break;case "omsstart":LPPlatform.setIntroTutorialDisable(!0),oneMinuteSignup.showWithProvider()}}if(null===f)switch(e.view){case "emergencyAccess":J.show();break;case "emergencyAccessOthers":K.show();break;default:u.show()}}}(),La=function(a){if(a){a=a.getAllSubGroupsIncludingFavorites(!0);for(var c=[],b=0,e=a.length;b<e;++b){var d=a[b];d.isExpanded()&&c.push(d._model.getName())}LPPlatform.setOpenGroups(c)}},
eb=function(a){var c=e.getElementById("sharedFoldersMenuItem").parentElement;a===Constants.USER_FREE&&($("#emptySharedFoldersIcon .tourText").append(LPTools.createElement("a",{"class":"nbtn rbtn dynamicWidth",href:LPProxy.getBaseURL()+"go-premium",target:"_blank"},Strings.translateString("Upgrade to Premium"))),c.parentElement.appendChild(c));$(c.parentElement).children().last().addClass("last")},Ja=function(a){$("#securityScore").text(null!==a?Math.round(a)+"%":"")};b.toggleInProgressOverlay=function(){$a.toggle()};
var W=function(a,c){0<c?(a.text(c),a.show()):a.hide()},Ia=function(){var a=!1;return function(){if(!a)for(var c=LPProxy.getEmergencyAccessRecipientModels(),b=0,e=c.length;b<e;++b){var d=c[b];if(d.allowedAccess()||d.hasRequestedAccess()){dialogs.denyEmergencyAccess.open({sharee:d});a=!0;break}}}}();b.openVault=function(){u.show()};b.openNotes=function(){Da.show()};b.openFormFills=function(){Ea.show()};b.toggleAdvancedMenu=function(a){ba.toggleClass("selected");R.toggle("fast");Z.toggle();F(a)};b.clear=
function(){n&&(n.destruct(),n=null);e.body.setAttribute("class","loggedout"+(LPPlatform.canBackgroundOpenPopover()?" canopenpopover":" cannotopenpopover"));$("#vaultLoadingOverlay").removeClass("loaded fadeIn");q.val("");C();t=x=B=U=f=null};b.maximizeLeftMenu=function(){h.addClass("maximized");E.addClass("opened");E.attr("title","Minimize Menu");LPProxy.setPreferences("leftMenuMaximize",!0);setTimeout(Topics.get(Topics.VAULT_LEFT_MENU_TOGGLE).publish,400)};b.minimizeLeftMenu=function(){h.removeClass("maximized");
E.removeClass("opened");E.attr("title","Maximize Menu");LPProxy.setPreferences("leftMenuMaximize",!1);setTimeout(Topics.get(Topics.VAULT_LEFT_MENU_TOGGLE).publish,400)};b.toggleLeftMenu=function(){h.hasClass("maximized")?b.minimizeLeftMenu():b.maximizeLeftMenu()};b.addSource=function(a){a?a.saveOptions&&a.saveOptions.source||(a.saveOptions={source:"vault"}):a={saveOptions:{source:"vault"}};return a};b.openSiteDialog=function(a){dialogs.site.open(b.addSource(a))};b.openTour=function(a){var c=bg.get("LPContentScriptFeatures")?
bg.get("LPContentScriptFeatures").tutorial_enabled:"40";a?c&&"41"===c?LPPlatform.openTour(a):G.show():c&&"41"===c?LPPlatform.openTour(a):LPProxy.getPreference("seenVault4.0")?(Ka(),q.focus()):(G.show(),bg.sendLpImprove&&bg.sendLpImprove("vaulttour",{version:c}))};b.openNoteDialog=function(a){dialogs.note.open(b.addSource(a))};b.openFormFillDialog=function(a){dialogs.formFill.open(b.addSource(a))};b.openFolderDialog=function(a,c){dialogs.folder.open({vaultItem:a,defaultData:{groupParent:c?c.getName():
""},groups:u.getContainer().getAllSubGroups()})};b.openCreateSharedFolderDialog=function(a,c){LPProxy.getAccountClass()===Constants.USER_FREE?dialogs.upgradePremium.open({upgradeText:[LPTools.createElement("h1","upgradeDialogHeader",Strings.translateString("Need to share passwords with family or friends?")),LPTools.createElement("p","dialogText",Strings.translateString("Go Premium now to create a Shared Folder, invite family or friends, and fill the folder with passwords and notes. Give up to 5 people access to the Shared Folder. Changes are synced automatically, and you can assign read-only access. Go Premium now to create a Shared Folder!"))]}):
dialogs.createSharedFolder.open({group:a,children:c})};b.openSettingsDialog=function(){null===U&&(AccountSettingsService.call(function(a){U=a;b.openSettingsDialog()},function(){Notifications.displayErrorMessage("Could not retrieve account settings!")}),Topics.get(Topics.DIALOG_LOADING).publish());dialogs.settings.open(U)};b.openLinkAccountDialog=function(){LPProxy.callAcctsIFrameCommand("linkpersonal")};b.unlinkAccount=function(){var a=LPProxy.getLinkedAccount();a&&a.unlink()};b.toggleCollapseAll=
function(){var a=!1;Topics.get(Topics.ALL_COLLAPSED).subscribe(function(){a=!0;S.addClass("selected");S.attr("title",Strings.Vault.EXPAND_ALL)});Topics.get(Topics.ALL_EXPANDED).subscribe(function(){a=!1;S.removeClass("selected");S.attr("title",Strings.Vault.COLLAPSE_ALL)});return function(){a?(Topics.get(Topics.EXPAND_ALL).publish(),Topics.get(Topics.ALL_EXPANDED).publish()):(Topics.get(Topics.COLLAPSE_ALL).publish(),Topics.get(Topics.ALL_COLLAPSED).publish())}}();b.toggleSize=function(){var a=!1;
b.displayLarge=function(){Topics.get(Topics.DISPLAY_LARGE).publish();a=!1;T.removeClass("selected");T.attr("title",Strings.Vault.COMPACT_VIEW);LPProxy.setPreferences("compactView",!1)};b.displayCompact=function(){Topics.get(Topics.DISPLAY_COMPACT).publish();a=!0;T.addClass("selected");T.attr("title",Strings.Vault.LARGE_VIEW);LPProxy.setPreferences("compactView",!0)};return function(){a?(b.displayLarge(),bg.lpevent(V?"v_grd_lrg":"v_lst_lrg")):(b.displayCompact(),bg.lpevent(V?"v_grd_cmp":"v_lst_cmp"))}}();
b.displayAsGrid=function(){Topics.get(Topics.DISPLAY_GRID).publish();ua.addClass("selected");va.removeClass("selected");LPProxy.setPreferences("gridView",!0);V=!0};b.displayAsList=function(){Topics.get(Topics.DISPLAY_LIST).publish();va.addClass("selected");ua.removeClass("selected");LPProxy.setPreferences("gridView",!1);V=!1};b.search=function(a){f&&f.search(a)};var Ma=function(a,c){switch(c){case z:a.sortByName(!0);break;case A:a.sortByName(!1);break;case ka:a.sortByFolder(!0);break;case la:a.sortByFolder(!1);
break;case Q:a.sortItemsByMostRecent();break;case ma:case oa:a.sortByEmail(!0);break;case na:case pa:a.sortByEmail(!1)}};b.sort=function(a){bb.text(a);Ma(f.getContainer(),a);f.setSortOrder(a)};b.showMoreOptionsMenu=function(){ya.show("fast")};b.hideMoreOptionsMenu=function(){ya.hide("fast")};b.openEmergencyAccess=function(){ea.show()};b.openEmergencyAccessTrusted=function(){ea.show(J)};b.openEmergencyAccessTrusting=function(){ea.show(K)};b.openSharingCenter=function(a){O.show()};b.openReceivedShareCenter=
function(a){O.show(L,a)};b.openSentShareCenter=function(a){O.show(M,a)};b.openSharedFolderCenter=function(a){O.show(y,a)};var N=!1,fa=function(a){y.getContainer().applyFilter({showEmptyGroups:!1,multiSelect:!1,func:function(a){return!a._model.isDeleted()}},a);N=!1},ga=function(a){y.getContainer().applyFilter({showEmptyGroups:!1,multiSelect:!1,func:function(a){return!0}},a);N=!0};b.openAcceptShareDialog=function(a){dialogs.acceptShare.open({vaultItem:a,groups:u.getContainer().getAllSubGroups()})};
b.openShareDialog=function(a){LPTools.openShareDialog(a)};b.openSharedFolderDialog=function(a,c){dialogs.sharedFolder.open(a,c)};b.openSharedFolderAccessDialog=function(a){dialogs.sharedfolderAccess.open(a)};b.openManageIdentities=function(){Fa.show()};b.openIdentityDialog=function(a){dialogs.identity.open(a)};b.enableIdentity=function(a){null!==B&&B!==a&&(B.disable(),LPProxy.enableIdentity(a));B=a;a=x?x._filter:null;null!==x&&(La(x),x.destruct());var c=LPProxy.getAllItems({identity:B}),c=new GridListContainer(c,
{separateItems:!0,separateFavorites:!0,stickyFolders:!0,ignoreFilterOnSearch:!0,keyboardNavigation:!0,stickyFolderParent:e.getElementById("main"),folderStateChange:La}),b=LPPlatform.getOpenGroups();if(null!==b){for(var d=!0,f=c.getAllSubGroupsIncludingFavorites(!0),h=0,l=f.length;h<l;++h){var m=f[h];b[m._model.getName()]?(m.expand(),d=!1):m.collapse()}d&&Topics.get(Topics.ALL_COLLAPSED).publish()}Ma(c,u.getSortOrder());c.initialize(e.getElementById("vaultContent"),r);c.applyFilter(a);u.setContainer(c);
Da.setContainer(c);Ea.setContainer(c);x=c};b.openCreditMonitoring=function(a){X.show()};b.openCreateCreditMonitoringDialog=function(){dialogs.createCreditMonitoring.open()};b.openDeletedItems=function(a){da.show()};var G=function(){var a=0,b=null,d=null,f=e.getElementById("tourItems"),l=$("#tourLeft"),n=$("#tourRight");l.hide();l.bind("click",function(){G.reverse()});n.bind("click",function(){G.advance()});for(var p=function(a){return function(){G.goTo(a)}},d=e.getElementById("tourSteps").children,
m=0,r=d.length;m<r;++m)LPPlatform.addEventListener(d[m],"click",p(m));d[0].setAttribute("class","tourStep selected");var q=function(c){if(c!==a&&0<=c&&c<d.length){d[a].setAttribute("class","tourStep");var e="tour"+(c+1);f.setAttribute("class",e);h.addClass(e);b&&h.removeClass(b);b=e;a=c;d[a].setAttribute("class","tourStep selected");0===c?l.hide():l.show();c===d.length-1?n.hide():n.show()}},t=function(){q(a+1)},u=function(){q(a-1)};return{advance:t,reverse:u,goTo:function(a){q(a)},hide:function(){h.removeClass("tourState");
h.removeClass(b);b=null;Topics.get(Topics.RIGHT_ARROW).unsubscribe(t);Topics.get(Topics.LEFT_ARROW).unsubscribe(u);bg.sendLpImprove&&bg.sendLpImprove("vaulttour::exit",{version:"40",page:a+1})},show:function(){q(0);h.addClass("tourState");Topics.get(Topics.RIGHT_ARROW).subscribe(t);Topics.get(Topics.LEFT_ARROW).subscribe(u);bg.sendLpImprove&&bg.sendLpImprove("vaulttour::start",{version:"40"})}}}();b.showAdPane=function(){var a=e.getElementById("ad"),b=e.createElement("iframe");b.setAttribute("src",
ja.getPartnerURL(LPProxy.getBaseURL()+"ads.php?nobr=1&noga=1&rand="+Math.floor(1E3*Math.random())+"&v="+LPProxy.getVersion()));a.appendChild(b);h.addClass("freeUser");setInterval(function(){b.setAttribute("src",ja.getPartnerURL(LPProxy.getBaseURL()+"ads.php?v=4.0&nobr=1&noga=1&rand="+Math.floor(1E3*Math.random())+"&v="+LPProxy.getVersion()))},3E5)};b.firstTimeLogin=function(){if(bg.get("g_first_time_login")){var a=LPTools.createElement("iframe",{"class":"displaynone",src:LPProxy.getBaseURL()+"lppixel.php"});
$("#main").after(a)}};h.bind("click",function(){ia()});$("#vault").bind("click",function(){C();ia()});$("#loginButton").bind("click",function(){bg.open_login()});LPPlatform.addEventListener(window,"unload",function(){Topics.get(Topics.CLEAR_DATA).publish()});q.LP_addSearchHandlers("inputLight",function(a){b.search(a)});q.bind("keydown",function(a){if(40===(a.keyCode||a.which)){var b=f.getContainer();b&&(b=b.getAllChildrenOrdered(),0<b.length&&(b[0].focus(),a.preventDefault(),a.stopPropagation()))}});
$("#orderOption").bind("click",function(a){xa.toggle("fast");t=xa;LPTools.addKeyBoardNavigation(ca.children);F(a)});$("#actions").bind("click",function(a){if(null===t||t.get(0).parentElement!==za){var b=f.createSelectionContextMenu();za.appendChild(b);b.removeAttribute("style");t=$(b);t.show("fast")}else P();F(a)});$("#sharingMenuItem").bind("click",function(){b.openSharingCenter()});ba.bind("click",b.toggleAdvancedMenu);Z.bind("click",ha);E.bind("click",b.toggleLeftMenu);LPPlatform.addEventListener(e.getElementById("settingsMenuItem"),
"click",function(){Topics.get(Topics.EDIT_SETTINGS).publish()});$("#linkAccountMenuItem").bind("click",function(){b.openLinkAccountDialog()});R.on("click",".toolsMenuItem.subMenuOption",function(){return!1});R.on("click",".toolsMenuItem",ha);w.bind("mouseenter",Ha);w.bind("mouseleave",Ga);w.bind("touchstart",function(a){w.unbind("mousenter");w.unbind("mouseleave");w.hasClass("open")||(Ha(),a.preventDefault())});LPPlatform.addEventListener(e.getElementById("collapseAllToggle"),"click",function(){b.toggleCollapseAll()});
LPPlatform.addEventListener(e.getElementById("showReminders"),"click",function(){oneMinuteSignup.show(oneMinuteSignup.modes.reminder)});LPPlatform.addEventListener(e.getElementById("sizeToggle"),"click",function(){b.toggleSize()});LPPlatform.addEventListener(e.getElementById("gridButton"),"click",function(){b.displayAsGrid()});LPPlatform.addEventListener(e.getElementById("listButton"),"click",function(){b.displayAsList()});LPPlatform.addEventListener(e.getElementById("userMenuContainer"),"click",
function(a){Aa.toggleClass("selected");aa.toggle("fast");F(a)});var Na=function(){G.hide();LPProxy.getPreference("seenVault4.0")||LPProxy.setPreferences("seenVault4.0",!0);Ka()};LPPlatform.addEventListener(e.getElementById("skipTour"),"click",Na);LPPlatform.addEventListener(e.getElementById("tourOpenMyVault"),"click",Na);LPPlatform.addEventListener(e.getElementById("manageIdentitiesMenuItem"),"click",function(){b.openManageIdentities()});LPPlatform.addEventListener(e.getElementById("creditMonitoringMenuItem"),
"click",function(){b.openCreditMonitoring()});LPPlatform.addEventListener(e.getElementById("openTourMenuItem"),"click",function(){b.openTour(!0)});$(".toolsMenuItem.subMenuOption").bind("click",function(a){$(a.target.parentElement.nextElementSibling).toggle("fast");$(a.target).toggleClass("selected");F(a)});LPPlatform.addEventListener(e.getElementById("toolsImport"),"click",function(){LPProxy["import"]()});LPPlatform.addEventListener(e.getElementById("toolsExport"),"click",function(){LPProxy["export"]()});
LPPlatform.addEventListener(e.getElementById("toolsOpenFavorites"),"click",function(){LPProxy.openAllFavorites()});LPPlatform.addEventListener(e.getElementById("bookmarkletsMenuItem"),"click",function(){LPProxy.openBookmarklets()});LPPlatform.addEventListener(e.getElementById("historyMenuItem"),"click",function(){LPProxy.openHistory()});LPPlatform.addEventListener(e.getElementById("deletedMenuItem"),"click",function(){b.openDeletedItems()});LPPlatform.addEventListener(e.getElementById("generateSharingKeys"),
"click",function(){bg.lpevent("v_gsk");dialogs.sharingKey.open()});$("#generateSharingKeys").hide();LPPlatform.addEventListener(e.getElementById("generatePasswordMenuItem"),"click",function(){bg.lpevent("v_gpw");dialogs.generatePassword.open({fillGenerated:!1,saveOptions:{source:"vault"}})});$("#generatePasswordMenuItem").hide();$("#removedLinkedAccountMenuItem").bind("click",function(){b.unlinkAccount()});$("#tryEnterprise").bind("click",function(){dialogs.enterpriseTrial.open()});$("#emergencyAccessMenuItem").bind("click",
function(){b.openEmergencyAccess()});$("#securityMenuItem").bind("click",function(){bg.lpevent("v_sec");bg.openseccheck()});$("#adminConsoleMenuItem").bind("click",function(){bg.lpevent("v_oec");bg.openentconsole()});Topics.get(Topics.ITEMS_DESELECTED).subscribe(function(){b.hideMoreOptionsMenu()});Topics.get(Topics.ITEMS_SELECTED).subscribe(function(){b.showMoreOptionsMenu()});Topics.get(Topics.SELECT_COUNT_CHANGE).subscribe(function(a){0<a&&(a+=" selected",$("#selectedItemCounter").text(a))});Topics.get(Topics.CONTEXT_MENU).subscribe(function(a,
b){b.parentElement!==e.body&&e.body.appendChild(b);t=LPTools.displayContextMenu(a,b)});Topics.get(Topics.CONTEXT_CLOSE).subscribe(function(){P()});Topics.get(Topics.ITEM_SHARE).subscribe(function(a){b.openShareDialog(a)});Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(a){b.enableIdentity(a)});Topics.get(Topics.CLEAR_DATA).subscribe(function(){b.clear();Dialog.prototype.closeAllDialogs(!0);LPProxy.closeIFrame()});Topics.get(Topics.LOGIN).subscribe(function(a){b.initialize(a);Dialog.prototype.closeAllDialogs()});
Topics.get(Topics.REQUEST_SUCCESS).subscribe(function(a){LPTools.getOption(a,"incrementAccountsVersion",!1)&&C()});(function(){var a=function(a,b,d){q.val("");C();x.addChild(a.newDisplayObject(),b,d)};Topics.get(Topics.SITE_ADDED).subscribe(a);Topics.get(Topics.NOTE_ADDED).subscribe(a);Topics.get(Topics.FORM_FILL_ADDED).subscribe(a);Topics.get(Topics.APPLICATION_ADDED).subscribe(a)})();Topics.get(Topics.EDIT_SHARED_FOLDER_ACCESS).subscribe(function(a){b.openSharedFolderAccessDialog(a)});Topics.get(Topics.EDIT_SITE).subscribe(function(a){b.openSiteDialog(a)});
Topics.get(Topics.EDIT_NOTE).subscribe(function(a){b.openNoteDialog(a)});Topics.get(Topics.EDIT_FORM_FILL).subscribe(function(a){b.openFormFillDialog(a)});Topics.get(Topics.EDIT_APPLICATION).subscribe(function(a){dialogs.application.open(a)});Topics.get(Topics.EDIT_SETTINGS).subscribe(function(){LPProxy.callAcctsIFrameCommand("settings")});Topics.get(Topics.EDIT_IDENTITY).subscribe(function(a){b.openIdentityDialog(a)});Topics.get(Topics.ACCEPT_SHARE).subscribe(function(a){b.openAcceptShareDialog(a)});
Topics.get(Topics.RENAME_FOLDER).subscribe(function(a){b.openFolderDialog(a)});Topics.get(Topics.CREATE_SUB_FOLDER).subscribe(function(a){b.openFolderDialog(null,a)});Topics.get(Topics.GROUP_ADDED).subscribe(function(a,b){q.val("");C();u.getContainer().addChild(a.newDisplayObject(),b);if(a instanceof SharedGroup){var c=y.getContainer();if(null!==c){var d=new SharedFolderItem(a);c.addChild(d)}}});Topics.get(Topics.ESCAPE).subscribe(function(a){(a=Dialog.prototype.getCurrentDialog())&&a.close();C();
ia()});Topics.get(Topics.EDIT_SHARED_FOLDER).subscribe(function(a,c){b.openSharedFolderDialog(a,c)});Topics.get(Topics.IDENTITY_ADDED).subscribe(function(a){Fa.getContainer().addChild(a.newDisplayObject())});Topics.get(Topics.REFRESH_DATA).subscribe(function(){LPProxy.initializeModel();Ia();LPProxy.getSecurityChallengeScore(Ja);Topics.get(Topics.IDENTITY_ENABLE).publish(B);Dialog.prototype.closeInProcessDialogs();VaultItemDialog.prototype.refreshOpenDialogs();Topics.get(Topics.REFRESH_PREFERENCES).publish();
P()});Topics.get(Topics.UPDATE_NOTIFICATION_COUNT).subscribe(function(a){f&&f.updateNotificationCount("number"===typeof a?a:1)});Topics.get(Topics.ACCOUNT_LINKED).subscribe(function(a){$("#linkAccountMenuItem").LP_hide();$("#removedLinkedAccountMenuItem").LP_show()});Topics.get(Topics.ACCOUNT_UNLINKED).subscribe(function(a){$("#linkAccountMenuItem").LP_show();$("#removedLinkedAccountMenuItem").LP_hide()});Topics.get(Topics.CREATE_SHARED_FOLDER).subscribe(function(a,c){b.openCreateSharedFolderDialog(a,
c)});Topics.get(Topics.REPROMPT).subscribe(function(a){dialogs.reprompt.open({successCallback:a})});Topics.get(Topics.CONFIRM).subscribe(function(a){dialogs.confirmation.open(a)});Topics.get(Topics.EMERGENCY_RECIPIENT_ADDED).subscribe(function(a){J.getContainer().addChild(a.newDisplayObject())});Topics.get(Topics.EDIT_EMERGENCY_RECIPIENT).subscribe(function(a){dialogs.addEmergencyAccess.open({vaultItem:a})});Topics.get(Topics.REAPPLY_SEARCH).subscribe(function(a,b){var c=q.val();c&&a.applySearch(c,
b)});Topics.get(Topics.ENROLLED_CREDIT_MONITORING).subscribe(function(){X.refresh()});Topics.get(Topics.ITEM_SHARED).subscribe(function(a){M.refresh()});Topics.get(Topics.REFRESH_PREFERENCES).subscribe(function(){LPFeatures.updateFeatures({"import":!0,noexport:!1,share:!0,share_onlyfolders:!1,show_notes:!0,bookmarklets:!0,hideidentities:!1,showcredmon:!0,link_personal:!0,show_formfills:!0});LPProxy.hasReceivedShares()?h.removeClass("noReceivedShares"):h.addClass("noReceivedShares");switch(f){case M:LPFeatures.allowIndividualSharing()||
(O.clear(),u.show(),dialogs.alert.open({title:Strings.translateString("Policy Update"),text:Strings.translateString("Your enterprise has prohibited individual sharing.")}));break;case y:LPFeatures.allowSharedFolders()||(u.show(),dialogs.alert.open({title:Strings.translateString("Policy Update"),text:Strings.translateString("Your enterprise has prohibited sharing.")}))}});Topics.get(Topics.INITIALIZED).subscribe(function(){Strings.translate(e.body);$("input,textarea").prop("spellcheck",!1)});LPPlatform.addEventListener(e,
"DOMContentLoaded",function(){Notifications.initialize()})})(document,LPVault,BuildVariables);
